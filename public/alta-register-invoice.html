<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Invoice - AEAT VERI*FACTU API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar h2 {
            padding: 0 2rem;
            margin-bottom: 1rem;
            color: #1e293b;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar li {
            margin: 0;
        }
        
        .sidebar a {
            display: block;
            padding: 0.75rem 2rem;
            color: #64748b;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .sidebar a:hover {
            background: #f1f5f9;
            color: #1e293b;
            border-left-color: #3b82f6;
        }
        
        .sidebar a.active {
            background: #eff6ff;
            color: #1d4ed8;
            border-left-color: #3b82f6;
            font-weight: 500;
        }
        
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }
        
        .header {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .header h1 {
            color: #1e293b;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .section {
            margin-bottom: 3rem;
        }
        
        .section h2 {
            color: #1e293b;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .section h3 {
            color: #374151;
            font-size: 1.3rem;
            margin: 2rem 0 1rem 0;
            font-weight: 600;
        }
        
        .section h4 {
            color: #4b5563;
            font-size: 1.1rem;
            margin: 1.5rem 0 0.5rem 0;
            font-weight: 600;
        }
        
        .section p {
            margin-bottom: 1rem;
            color: #4b5563;
        }
        
        .section ul, .section ol {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }
        
        .section li {
            margin: 0.5rem 0;
            color: #4b5563;
        }
        
        .code {
            background: #1e293b;
            color: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            margin: 1rem 0;
            overflow-x: auto;
        }
        
        .inline-code {
            background: #f1f5f9;
            color: #1e293b;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }
        
        .note {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .note strong {
            color: #92400e;
        }
        
        .warning {
            background: #fef2f2;
            border: 1px solid #f87171;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .warning strong {
            color: #dc2626;
        }
        
        .success {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .success strong {
            color: #16a34a;
        }
        
        .card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .card h4 {
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        
        .card p {
            color: #64748b;
            margin: 0;
        }
        
        .card a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
        }
        
        .card a:hover {
            text-decoration: underline;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .soap-action {
            background: #1e293b;
            color: #f1f5f9;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 1.1rem;
            margin: 1rem 0;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <h2>Documentation</h2>
            <ul>
                <li><a href="index.html">Welcome</a></li>
                <li><a href="authentication.html">Authentication</a></li>
                <li><a href="index.html#api-operations">API Operations</a></li>
                <li><a href="index.html#implementation">Implementation Guide</a></li>
                <li><a href="index.html#resources">Resources</a></li>
            </ul>
            
            <h2>API Reference</h2>
            <ul>
                <li><a href="alta-register-invoice.html" class="active">Register Invoice</a></li>
                <li><a href="baja-cancel-invoice.html">Cancel Invoice</a></li>
                <li><a href="consulta-query-invoice.html">Query Invoice</a></li>
                <li><a href="parameters-and-fields.html">Parameters & Fields</a></li>
                <li><a href="error-handling.html">Error Handling</a></li>
                <li><a href="xsd-schema-reference.html">XSD Schema</a></li>
            </ul>
            
            <h2>Getting Started</h2>
            <ul>
                <li><a href="authentication.html">Authentication Setup</a></li>
                <li><a href="node-implementation.html">Node.js Implementation</a></li>
                <li><a href="examples.html">Examples</a></li>
                <li><a href="quick-reference.html">Quick Reference</a></li>
            </ul>
        </nav>
        
        <main class="main-content">
            <div class="header">
                <h1>Register Invoice (Alta)</h1>
            </div>
            
            <section class="section">
                <h2>Overview</h2>
                <p>The Alta operation is used to register invoices with the Spanish tax authority (AEAT) for verification. This is the primary operation for invoice verification and must be performed before sending invoices to customers.</p>
                
                <div class="card">
                    <h4>Purpose</h4>
                    <ul>
                        <li><strong>Real-time Validation</strong>: Validate invoice data against Spanish tax rules</li>
                        <li><strong>CSV Generation</strong>: Generate secure verification codes for invoices</li>
                        <li><strong>Compliance</strong>: Ensure compliance with Spanish tax regulations</li>
                        <li><strong>Fraud Prevention</strong>: Prevent tax fraud through verification</li>
                    </ul>
                </div>
            </section>
            
            <section class="section">
                <h2>SOAP Action</h2>
                <div class="soap-action">
                    SOAPAction: "urn:VeriFactu/Alta"
                </div>
            </section>
            
            <section class="section">
                <h2>XML Namespaces</h2>
                <div class="code">
xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
xmlns:verifactu="urn:VeriFactu"
xmlns:aeat="http://www.aeat.es/verifactu"
xmlns:factura="urn:VeriFactu:Factura"
xmlns:cabecera="urn:VeriFactu:Cabecera"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                </div>
            </section>
            
            <section class="section">
                <h2>Request Structure</h2>
                
                <h3>SOAP Envelope</h3>
                <div class="code">
<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:verifactu="urn:VeriFactu"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <soap:Header>
    <!-- Authentication handled via mutual TLS -->
  </soap:Header>
  <soap:Body>
    <verifactu:Alta>
      <verifactu:Cabecera>
        <!-- Header information -->
      </verifactu:Cabecera>
      <verifactu:Factura>
        <!-- Invoice data -->
      </verifactu:Factura>
    </verifactu:Alta>
  </soap:Body>
</soap:Envelope>
                </div>
            </section>
            
            <section class="section">
                <h2>Required Fields</h2>
                
                <h3>Header Information (Cabecera)</h3>
                <ul>
                    <li><strong>NIF</strong>: Tax identification number of the issuer</li>
                    <li><strong>Fecha</strong>: Date of the invoice</li>
                    <li><strong>Hora</strong>: Time of the invoice</li>
                    <li><strong>Serie</strong>: Invoice series (optional)</li>
                    <li><strong>NumFactura</strong>: Invoice number</li>
                </ul>
                
                <h3>Invoice Data (Factura)</h3>
                <ul>
                    <li><strong>ImporteTotal</strong>: Total amount of the invoice</li>
                    <li><strong>ImporteTotalConImpuestos</strong>: Total amount including taxes</li>
                    <li><strong>TipoFactura</strong>: Type of invoice (F1, F2, etc.)</li>
                    <li><strong>ClaveRegimenEspecialOTrascendencia</strong>: Special regime key</li>
                </ul>
            </section>
            
            <section class="section">
                <h2>Response Structure</h2>
                
                <h3>Success Response</h3>
                <div class="code">
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Body>
    <verifactu:AltaResponse>
      <verifactu:Resultado>
        <verifactu:Codigo>0</verifactu:Codigo>
        <verifactu:Descripcion>OK</verifactu:Descripcion>
        <verifactu:CSV>ABC123456789</verifactu:CSV>
      </verifactu:Resultado>
    </verifactu:AltaResponse>
  </soap:Body>
</soap:Envelope>
                </div>
                
                <div class="success">
                    <strong>Success Response Fields:</strong>
                    <ul>
                        <li><strong>Codigo</strong>: Response code (0 = success)</li>
                        <li><strong>Descripcion</strong>: Description of the result</li>
                        <li><strong>CSV</strong>: Secure verification code for the invoice</li>
                    </ul>
                </div>
            </section>
            
            <section class="section">
                <h2>Error Handling</h2>
                
                <h3>Common Error Codes</h3>
                <div class="grid">
                    <div class="card">
                        <h4>Validation Errors</h4>
                        <ul>
                            <li><strong>1001</strong>: Invalid NIF format</li>
                            <li><strong>1002</strong>: Invalid invoice number</li>
                            <li><strong>1003</strong>: Invalid amount format</li>
                        </ul>
                    </div>
                    
                    <div class="card">
                        <h4>System Errors</h4>
                        <ul>
                            <li><strong>2001</strong>: Service temporarily unavailable</li>
                            <li><strong>2002</strong>: Database connection error</li>
                            <li><strong>2003</strong>: Authentication failed</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <section class="section">
                <h2>Implementation Example</h2>
                
                <h3>Node.js Implementation</h3>
                <div class="code">
const https = require('https');
const fs = require('fs');

// Certificate configuration
const options = {
  key: fs.readFileSync('client-key.pem'),
  cert: fs.readFileSync('client-cert.pem'),
  ca: fs.readFileSync('ca-cert.pem'),
  hostname: 'prewww1.aeat.es',
  port: 443,
  path: '/wlpl/TIKE-CONT/ws/SistemaFacturacion/VerifactuSOAP',
  method: 'POST',
  headers: {
    'Content-Type': 'text/xml; charset=utf-8',
    'SOAPAction': 'urn:VeriFactu/Alta'
  }
};

// SOAP request body
const soapBody = `<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Body>
    <verifactu:Alta>
      <!-- Your invoice data here -->
    </verifactu:Alta>
  </soap:Body>
</soap:Envelope>`;

// Make the request
const req = https.request(options, (res) => {
  let data = '';
  res.on('data', (chunk) => {
    data += chunk;
  });
  res.on('end', () => {
    console.log('Response:', data);
  });
});

req.on('error', (error) => {
  console.error('Error:', error);
});

req.write(soapBody);
req.end();
                </div>
            </section>
            
            <div class="note">
                <strong>Important:</strong> Always test with the test environment first before using production. The test environment URL is: <span class="inline-code">https://prewww1.aeat.es/wlpl/TIKE-CONT/ws/SistemaFacturacion/VerifactuSOAP</span>
            </div>
        </main>
    </div>
</body>
</html>
