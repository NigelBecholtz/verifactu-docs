{"version":3,"file":"zudoku.plugin-search-inkeep.js","sources":["../src/lib/plugins/search-inkeep/inkeep.ts","../src/lib/plugins/search-inkeep/index.tsx"],"sourcesContent":["import type {\n  InkeepAIChatSettings,\n  InkeepBaseSettings,\n  InkeepModalSettings,\n  InkeepSearchSettings,\n} from \"@inkeep/cxkit-types\";\n\nconst baseSettings: InkeepBaseSettings = {\n  primaryBrandColor: \"#26D6FF\",\n};\n\nconst modalSettings: InkeepModalSettings = {\n  shortcutKey: \"k\",\n};\n\nconst searchSettings: InkeepSearchSettings = {\n  placeholder: \"Search...\",\n};\n\nconst aiChatSettings: InkeepAIChatSettings = {\n  aiAssistantName: \"Assistant\",\n};\n\nexport { aiChatSettings, baseSettings, modalSettings, searchSettings };\n","import type {\n  InkeepBaseSettings,\n  InkeepComponentInstance,\n  InkeepJS,\n  InkeepSettings,\n} from \"@inkeep/cxkit-types\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { ClientOnly } from \"../../components/ClientOnly.js\";\nimport type { ZudokuPlugin } from \"../../core/plugins.js\";\nimport {\n  aiChatSettings,\n  baseSettings,\n  modalSettings,\n  searchSettings,\n} from \"./inkeep.js\";\n\ndeclare global {\n  interface Window {\n    Inkeep: InkeepJS | undefined;\n  }\n}\n\nconst InkeepSearch = ({\n  isOpen,\n  onClose,\n  settings,\n}: {\n  isOpen: boolean;\n  onClose: () => void;\n  settings: InkeepBaseSettings;\n}) => {\n  const config = useMemo<InkeepSettings>(\n    () => ({\n      baseSettings: {\n        ...baseSettings,\n        ...settings,\n        colorMode: {\n          sync: {\n            target: \"html\",\n            attributes: [\"class\"],\n            isDarkMode: (attrs) => attrs.class?.includes(\"dark\") ?? false,\n          },\n        },\n      },\n      modalSettings: {\n        ...modalSettings,\n        onOpenChange: (newOpen: boolean) => {\n          if (!newOpen) onClose();\n        },\n      },\n      searchSettings,\n      aiChatSettings,\n    }),\n    [onClose, settings],\n  );\n  const [searchInstance, setSearchInstance] = useState<\n    InkeepComponentInstance | undefined\n  >(\n    typeof window !== \"undefined\" && window.Inkeep?.ModalSearchAndChat\n      ? window.Inkeep.ModalSearchAndChat(config)\n      : undefined,\n  );\n\n  useEffect(() => {\n    if (searchInstance) return;\n\n    const checkInkeep = setInterval(() => {\n      if (typeof window !== \"undefined\" && window.Inkeep?.ModalSearchAndChat) {\n        const inkeep = window.Inkeep.ModalSearchAndChat(config);\n        setSearchInstance(inkeep);\n        clearInterval(checkInkeep);\n      }\n    }, 100);\n\n    return () => clearInterval(checkInkeep);\n  }, [config, searchInstance]);\n\n  useEffect(() => {\n    if (!searchInstance) return;\n\n    searchInstance.update({ modalSettings: { isOpen } });\n  }, [isOpen, searchInstance]);\n\n  return null;\n};\n\nexport const inkeepSearchPlugin = (\n  settings: InkeepBaseSettings,\n): ZudokuPlugin => {\n  return {\n    getHead: () => {\n      return (\n        <script\n          type=\"module\"\n          src=\"https://cdn.jsdelivr.net/npm/@inkeep/cxkit-js@0.5.90/+esm\"\n          defer\n        />\n      );\n    },\n    renderSearch: ({\n      isOpen,\n      onClose,\n    }: {\n      isOpen: boolean;\n      onClose: () => void;\n    }) => {\n      return (\n        <ClientOnly>\n          <InkeepSearch isOpen={isOpen} onClose={onClose} settings={settings} />\n        </ClientOnly>\n      );\n    },\n  };\n};\n"],"names":["baseSettings","modalSettings","searchSettings","aiChatSettings","InkeepSearch","isOpen","onClose","settings","config","useMemo","attrs","newOpen","searchInstance","setSearchInstance","useState","useEffect","checkInkeep","inkeep","inkeepSearchPlugin","jsx","ClientOnly"],"mappings":";;;AAOA,MAAMA,IAAmC;AAAA,EACvC,mBAAmB;AACrB,GAEMC,IAAqC;AAAA,EACzC,aAAa;AACf,GAEMC,IAAuC;AAAA,EAC3C,aAAa;AACf,GAEMC,IAAuC;AAAA,EAC3C,iBAAiB;AACnB,GCCMC,IAAe,CAAC;AAAA,EACpB,QAAAC;AAAA,EACA,SAAAC;AAAA,EACA,UAAAC;AACF,MAIM;AACJ,QAAMC,IAASC;AAAA,IACb,OAAO;AAAA,MACL,cAAc;AAAA,QACZ,GAAGT;AAAA,QACH,GAAGO;AAAA,QACH,WAAW;AAAA,UACT,MAAM;AAAA,YACJ,QAAQ;AAAA,YACR,YAAY,CAAC,OAAO;AAAA,YACpB,YAAY,CAACG,MAAUA,EAAM,OAAO,SAAS,MAAM,KAAK;AAAA,UAAA;AAAA,QAC1D;AAAA,MACF;AAAA,MAEF,eAAe;AAAA,QACb,GAAGT;AAAA,QACH,cAAc,CAACU,MAAqB;AAClC,UAAKA,KAASL,EAAA;AAAA,QAChB;AAAA,MAAA;AAAA,MAEF,gBAAAJ;AAAA,MACA,gBAAAC;AAAA,IAAA;AAAA,IAEF,CAACG,GAASC,CAAQ;AAAA,EAAA,GAEd,CAACK,GAAgBC,CAAiB,IAAIC;AAAA,IAG1C,OAAO,SAAW,OAAe,OAAO,QAAQ,qBAC5C,OAAO,OAAO,mBAAmBN,CAAM,IACvC;AAAA,EAAA;AAGN,SAAAO,EAAU,MAAM;AACd,QAAIH,EAAgB;AAEpB,UAAMI,IAAc,YAAY,MAAM;AACpC,UAAI,OAAO,SAAW,OAAe,OAAO,QAAQ,oBAAoB;AACtE,cAAMC,IAAS,OAAO,OAAO,mBAAmBT,CAAM;AACtD,QAAAK,EAAkBI,CAAM,GACxB,cAAcD,CAAW;AAAA,MAC3B;AAAA,IACF,GAAG,GAAG;AAEN,WAAO,MAAM,cAAcA,CAAW;AAAA,EACxC,GAAG,CAACR,GAAQI,CAAc,CAAC,GAE3BG,EAAU,MAAM;AACd,IAAKH,KAELA,EAAe,OAAO,EAAE,eAAe,EAAE,QAAAP,EAAA,GAAU;AAAA,EACrD,GAAG,CAACA,GAAQO,CAAc,CAAC,GAEpB;AACT,GAEaM,IAAqB,CAChCX,OAEO;AAAA,EACL,SAAS,MAELY,gBAAAA,EAAAA;AAAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAK;AAAA,MACL,KAAI;AAAA,MACJ,OAAK;AAAA,IAAA;AAAA,EAAA;AAAA,EAIX,cAAc,CAAC;AAAA,IACb,QAAAd;AAAA,IACA,SAAAC;AAAA,EAAA,4BAMGc,GAAA,EACC,UAAAD,gBAAAA,EAAAA,IAACf,KAAa,QAAAC,GAAgB,SAAAC,GAAkB,UAAAC,GAAoB,EAAA,CACtE;AAEJ;"}